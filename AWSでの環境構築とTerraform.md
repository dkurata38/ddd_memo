# AWSでの環境構築とTerraform

## AWSでアプリケーション環境を作成する

### ネットワーク


#### ロケーションとリソース

AWSの拠点には3種類ある。
リージョン
エッジロケーション

そんなわけかわからんけれどもリージョンごとのリソースとリージョンをまたいだリソースの2種類に大別できる。
前者は外部との通信を遮断した上でリソース間ネットワークレベルでセキュリティを保護する戦略を取る。
後者は外部との通信を受け入れた上でファイアフォールによる保護を適用する。

#### 概論

VPC
リージョン内で稼働
AWSリソースを作成する仮想ネットワーク環境

AZ
リージョンよりも細かい単位のデータセンターのエリア分け。東京リージョンには3つのAZがある

サブネット
VPC内のIPアドレスを分割する

ゲートウェイ
外部・VPC・サブネット間のネットワーク接続の設定。
インターネットゲートウェイとVPNが外部とVPCの接続を設定。
NATゲートウェイはサブネット同士の接続を設定。


#### 設計時の考え方

まずPublicなサブネットとPrivateなサブネットを分ける。
踏み出いサーバはPublicなサブネットに置いてよいが、アプリケーションサーバやDBサーバはPrivateなサブネットに構築し、外界からのアクセスを必要最低限にする必要がある。
ただ、Privateなサブネットにサーバを置くだけだと、インターネットに接続できなくなるのでミドルウェアのインストールなどを行えなくなる。
個別にElasticIPを貼るか、PrivateなサブネットとPublicなサブネットをNATゲートウェイで繋ぐ。

ちなみにサブネットの分け方は以下の組み合わせで考えるのが良い。
環境識別子 * リソース種別

サブネットとIPレンジの設計は以下のサイトがとても参考になりそう。
https://qiita.com/nisshiee/items/df4261132ec686964605

Route53
エッジサーバで稼働